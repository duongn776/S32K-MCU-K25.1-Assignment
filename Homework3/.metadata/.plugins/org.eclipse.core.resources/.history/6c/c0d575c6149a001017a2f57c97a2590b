#include "Driver_GPIO.h"
#include "Driver_PORT.h"

/* ==== Định nghĩa pin trên board S32K144EVB ==== */
#define BTN1_PIN        (2 * 32 + 12U)   // PC12 → Button SW2
#define BTN2_PIN        (2 * 32 + 13U)   // PC13 → Button SW3
#define RED_LED_PIN     (3 * 32 + 0U)    // PD0  → Red LED
#define GREEN_LED_PIN   (3 * 32 + 16U)   // PD16 → Green LED

extern ARM_DRIVER_GPIO Driver_GPIO0;

/* Trạng thái LED */
static uint32_t red_led_state   = 0U;
static uint32_t green_led_state = 0U;

void App_Init(void)
{
    /* ====== Setup Red LED ====== */
    Driver_GPIO0.Setup(RED_LED_PIN, NULL);
    Driver_GPIO0.SetDirection(RED_LED_PIN, ARM_GPIO_OUTPUT);
    Driver_GPIO0.SetOutputMode(RED_LED_PIN, ARM_GPIO_PUSH_PULL);
    Driver_GPIO0.SetOutput(RED_LED_PIN, red_led_state);

    /* ====== Setup Green LED ====== */
    Driver_GPIO0.Setup(GREEN_LED_PIN, NULL);
    Driver_GPIO0.SetDirection(GREEN_LED_PIN, ARM_GPIO_OUTPUT);
    Driver_GPIO0.SetOutputMode(GREEN_LED_PIN, ARM_GPIO_PUSH_PULL);
    Driver_GPIO0.SetOutput(GREEN_LED_PIN, green_led_state);

    /* ====== Setup Button 1 ====== */
    Driver_GPIO0.Setup(BTN1_PIN, NULL);
    Driver_GPIO0.SetDirection(BTN1_PIN, ARM_GPIO_INPUT);
    Driver_GPIO0.SetPullResistor(BTN1_PIN, ARM_GPIO_PULL_UP);

    /* ====== Setup Button 2 ====== */
    Driver_GPIO0.Setup(BTN2_PIN, NULL);
    Driver_GPIO0.SetDirection(BTN2_PIN, ARM_GPIO_INPUT);
    Driver_GPIO0.SetPullResistor(BTN2_PIN, ARM_GPIO_PULL_UP);
}

int main(void)
{
    App_Init();

    uint32_t prev_btn1 = 1U;
    uint32_t prev_btn2 = 1U;

    while (1)
    {
        uint32_t btn1_state = Driver_GPIO0.GetInput(BTN1_PIN);
        uint32_t btn2_state = Driver_GPIO0.GetInput(BTN2_PIN);

        /* Phát hiện cạnh xuống BTN1 → toggle Red LED */
        if ((prev_btn1 == 1U) && (btn1_state == 0U)) {
            red_led_state ^= 1U;
            Driver_GPIO0.SetOutput(RED_LED_PIN, red_led_state);
        }

        /* Phát hiện cạnh xuống BTN2 → toggle Green LED */
        if ((prev_btn2 == 1U) && (btn2_state == 0U)) {
            green_led_state ^= 1U;
            Driver_GPIO0.SetOutput(GREEN_LED_PIN, green_led_state);
        }

        prev_btn1 = btn1_state;
        prev_btn2 = btn2_state;
    }
}
